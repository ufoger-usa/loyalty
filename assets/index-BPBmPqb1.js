const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ClaimPunchPage-BwU8shMy.js","assets/vendor-ZLzkZQbJ.js","assets/vendor_firebase-Ck53W5MB.js","assets/vendor_react-dom-B1D0ftzI.js","assets/CustomerRecords-BpumS2v9.js","assets/CustomerPage-By3sDlnJ.js"])))=>i.map(i=>d[i]);
import{j as e,Q as ye,b as t,u as Ce,R as Ee,c as we,d as Z,H as Re}from"./vendor-ZLzkZQbJ.js";import{c as je}from"./vendor_react-dom-B1D0ftzI.js";import{i as Ae,g as ve,q as M,c as ee,o as te,a as oe,d as H,s as N,b as k}from"./vendor_firebase-Ck53W5MB.js";(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))b(a);new MutationObserver(a=>{for(const u of a)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&b(d)}).observe(document,{childList:!0,subtree:!0});function p(a){const u={};return a.integrity&&(u.integrity=a.integrity),a.referrerPolicy&&(u.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?u.credentials="include":a.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function b(a){if(a.ep)return;a.ep=!0;const u=p(a);fetch(a.href,u)}})();const Se="modulepreload",Fe=function(C){return"/loyalty/"+C},ne={},re=function(h,p,b){let a=Promise.resolve();if(p&&p.length>0){let d=function(l){return Promise.all(l.map(x=>Promise.resolve(x).then(r=>({status:"fulfilled",value:r}),r=>({status:"rejected",reason:r}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),E=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));a=d(p.map(l=>{if(l=Fe(l),l in ne)return;ne[l]=!0;const x=l.endsWith(".css"),r=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${r}`))return;const f=document.createElement("link");if(f.rel=x?"stylesheet":Se,x||(f.as="script"),f.crossOrigin="",f.href=l,E&&f.setAttribute("nonce",E),document.head.appendChild(f),x)return new Promise((T,z)=>{f.addEventListener("load",T),f.addEventListener("error",()=>z(new Error(`Unable to preload CSS for ${l}`)))})}))}function u(d){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=d,window.dispatchEvent(c),!c.defaultPrevented)throw d}return a.then(d=>{for(const c of d||[])c.status==="rejected"&&u(c.reason);return h().catch(u)})};function De({totalPunches:C=10,currentPunches:h=0}){const p=[];for(let b=0;b<C;b++)p.push(e.jsx("div",{style:{width:"1rem",height:"1rem",borderRadius:"50%",backgroundColor:b<h?"#32D74B":"#E5E5EA"}},b));return e.jsx("div",{style:{display:"flex",justifyContent:"center",gap:"0.375rem"},children:p})}function ke({value:C,size:h=128}){return e.jsx("div",{className:"qr-code-container",style:{textAlign:"center"},children:e.jsx("div",{className:"qr-code-actual",style:{marginTop:"10px",marginBottom:"10px"},children:C?e.jsx(ye,{value:C,size:h,bgColor:"#ffffff",fgColor:"#000000",level:"L"}):e.jsx("p",{children:"No QR code data available."})})})}const Pe={apiKey:"AIzaSyB3a-4cuYh3BgstXQPI4XCiTjmuyOtzsSM",authDomain:"ufoger-loyalty.firebaseapp.com",projectId:"ufoger-loyalty",storageBucket:"ufoger-loyalty.firebasestorage.app",messagingSenderId:"474748620137",appId:"1:474748620137:web:3340ce8e46c2406e2341f8"},ze=Ae(Pe),W=ve(ze),Ie=t.lazy(()=>re(()=>import("./ClaimPunchPage-BwU8shMy.js"),__vite__mapDeps([0,1,2,3]))),Be=t.lazy(()=>re(()=>import("./CustomerRecords-BpumS2v9.js"),__vite__mapDeps([4,1,2,3]))),Le=t.lazy(()=>re(()=>import("./CustomerPage-By3sDlnJ.js"),__vite__mapDeps([5,1,2,3]))),Ne="1234",Te=({handleLockAdmin:C,customerPhoneNumber:h,handlePhoneNumberChange:p,customerNameInput:b,handleCustomerNameChange:a,loadCustomerData:u,isLoadingCustomer:d,activeCustomerData:c,currentPunches:E,totalPunches:l,isRewardAvailable:x,addPunch:r,isSavingPunch:f,handleGeneratePunchQrCode:T,redeemReward:z,isRedeemingReward:$,feedbackMessage:m,customers:I,onSelectCustomerByLast4:O})=>{const[B,w]=Z.useState(""),[U,y]=Z.useState([]);return Z.useEffect(()=>{/^\d{4}$/.test(B)&&I&&I.length>0?y(I.filter(R=>R.id&&R.id.slice(-4)===B)):y([])},[B,I]),e.jsxs("div",{className:"admin-main-container",style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:"1.25rem",boxSizing:"border-box",overflowY:"auto",padding:"0.1rem"},children:[e.jsxs("div",{style:{backgroundColor:"#FFFFFF",border:"1px solid #D1D1D6",borderRadius:"1rem",padding:"1.5rem",display:"flex",flexDirection:"column",gap:"1rem",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.03)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h2",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#1C1C1E"},children:"Admin Controls"}),e.jsx("button",{onClick:C,style:{backgroundColor:"#D1D1D6",color:"#1C1C1E",padding:"0.375rem 0.75rem",borderRadius:"0.375rem",fontSize:"0.75rem",border:"none"},children:"Lock"})]}),e.jsx("input",{type:"tel",value:h,onChange:p,placeholder:"Customer Phone (ID)",disabled:d,style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",backgroundColor:"#FFFFFF",color:"#1C1C1E",border:"1px solid #D1D1D6","::placeholder":{color:"#8E8E93"},boxSizing:"border-box"}}),e.jsx("input",{type:"text",value:b,onChange:a,placeholder:"Customer Name",disabled:d,style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",backgroundColor:"#FFFFFF",color:"#1C1C1E",border:"1px solid #D1D1D6","::placeholder":{color:"#8E8E93"},boxSizing:"border-box"}}),e.jsx("button",{onClick:u,disabled:d||!h.trim(),style:{width:"100%",backgroundColor:"#E5E5EA",color:"#1C1C1E",fontWeight:"600",paddingBlock:"0.75rem",borderRadius:"0.5rem",border:"none",boxSizing:"border-box"},children:d?"Loading...":"Load/Create"}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("input",{type:"text",value:B,onChange:R=>w(R.target.value.replace(/[^\d]/g,"").slice(0,4)),placeholder:"Find by last 4 digits",style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",border:"1px solid #D1D1D6",marginBottom:"0.5rem",boxSizing:"border-box"}}),U.length>0&&e.jsxs("div",{style:{background:"#f9fafb",border:"1px solid #e5e7eb",borderRadius:6,padding:8,marginBottom:8},children:[e.jsx("div",{style:{fontSize:13,color:"#555",marginBottom:4},children:"Select customer:"}),U.map(R=>e.jsxs("button",{onClick:()=>O(R),style:{display:"block",width:"100%",textAlign:"left",padding:6,border:"none",background:"#fff",borderRadius:4,marginBottom:4,cursor:"pointer"},children:[R.name||"N/A"," ",e.jsxs("span",{style:{color:"#007bff"},children:["(",R.id,")"]})]},R.id))]})]})]}),c&&e.jsxs("div",{style:{backgroundColor:"#FFFFFF",border:"1px solid #D1D1D6",borderRadius:"1rem",padding:"1.5rem",display:"flex",flexDirection:"column",gap:"1rem",textAlign:"center",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.03)"},children:[e.jsxs("h3",{style:{color:"#1C1C1E",fontWeight:"bold",fontSize:"1.125rem"},children:[c.name||"N/A",e.jsxs("span",{style:{fontSize:"0.875rem",color:"#3C3C3E"},children:[" (",c.id,")"]})]}),e.jsx(De,{currentPunches:E,totalPunches:l,isRewardAvailable:x}),e.jsxs("p",{style:{fontSize:"0.875rem",color:"#3C3C3E"},children:[E," / ",l]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[e.jsx("button",{onClick:r,disabled:f||E>=l||d,style:{backgroundColor:"#E5E5EA",color:"#1C1C1E",fontWeight:"600",paddingBlock:"0.75rem",borderRadius:"0.5rem",border:"none"},children:f?"...":"Add Punch"}),e.jsx("button",{onClick:T,disabled:!c||E>=l||d,style:{backgroundColor:"#E5E5EA",color:"#1C1C1E",fontWeight:"600",paddingBlock:"0.75rem",borderRadius:"0.5rem",border:"none"},children:"Generate Punch QR"}),e.jsx("button",{onClick:z,disabled:$||!x||d,style:{backgroundColor:"#E5E5EA",color:"#1C1C1E",fontWeight:"600",paddingBlock:"0.75rem",borderRadius:"0.5rem",border:"none"},children:$?"...":"Redeem"})]})]}),m.text&&e.jsx("div",{style:{position:"fixed",bottom:"1.5rem",left:"50%",transform:"translateX(-50%)",padding:"0.75rem 1.25rem",borderRadius:"0.5rem",backgroundColor:m.type==="error"?"#FFEBEB":m.type==="success"?"#E6F7E9":"#E0F2FE",color:m.type==="error"?"#BF2C2C":m.type==="success"?"#1D7A2E":"#0C5A8A",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:1e3,fontSize:"0.875rem",border:"1px solid ",borderColor:m.type==="error"?"#FAD1D1":m.type==="success"?"#C6E6CC":"#B8DFF8"},children:m.text})]})},_e=({isAdminUnlocked:C,pinInput:h,handlePinInputChange:p,handlePinSubmit:b,handleLockAdmin:a,customerPhoneNumber:u,handlePhoneNumberChange:d,customerNameInput:c,handleCustomerNameChange:E,loadCustomerData:l,isLoadingCustomer:x,activeCustomerData:r,currentPunches:f,totalPunches:T,isRewardAvailable:z,addPunch:$,isSavingPunch:m,handleGeneratePunchQrCode:I,redeemReward:O,isRedeemingReward:B,feedbackMessage:w,isPunchQrModalOpen:U,actionableQrUrl:y,setIsPunchQrModalOpen:R,matchingCustomers:V,showMatchModal:X,setShowMatchModal:Q,customers:Y,onSelectCustomerByLast4:K})=>{const[v,q]=t.useState(window.innerWidth<768);return t.useEffect(()=>{const j=()=>{q(window.innerWidth<768)};return window.addEventListener("resize",j),()=>window.removeEventListener("resize",j)},[]),C?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:v?"column":"row",gap:"1.5rem",width:"100%",maxWidth:v?"100%":"72rem",margin:"0 auto",boxSizing:"border-box",flexGrow:1,padding:"0 0.75rem 1rem 0.75rem",overflowY:v?"auto":"hidden",overflowX:"hidden"},children:[e.jsx("div",{style:{flex:v?"1 1 auto":"1 1 0%",width:v?"100%":"auto",minWidth:v?"unset":"18rem",display:"flex",flexDirection:"column",marginBottom:v?"1.5rem":"0"},children:e.jsx(Te,{handleLockAdmin:a,customerPhoneNumber:u,handlePhoneNumberChange:d,customerNameInput:c,handleCustomerNameChange:E,loadCustomerData:l,isLoadingCustomer:x,activeCustomerData:r,currentPunches:f,totalPunches:T,isRewardAvailable:z,addPunch:$,isSavingPunch:m,handleGeneratePunchQrCode:I,redeemReward:O,isRedeemingReward:B,feedbackMessage:w,customers:Y,onSelectCustomerByLast4:K})}),e.jsx("div",{style:{flex:v?"1 1 auto":"2 1 0%",width:v?"100%":"auto",minWidth:v?"unset":"24rem",display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{textAlign:"center",fontSize:"1.1rem",paddingTop:"2rem"},children:"Loading records..."}),children:e.jsx(Be,{})})})]}),X&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.4)",zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>Q(!1),children:e.jsxs("div",{style:{background:"#fff",borderRadius:12,padding:24,minWidth:320,maxWidth:400,boxShadow:"0 2px 8px #0002"},onClick:j=>j.stopPropagation(),children:[e.jsx("h3",{style:{marginTop:0},children:"Select Customer"}),e.jsx("ul",{style:{listStyle:"none",padding:0,margin:0},children:V.map(j=>e.jsx("li",{style:{marginBottom:12},children:e.jsxs("button",{style:{width:"100%",padding:10,borderRadius:6,border:"1px solid #ccc",background:"#f5f5f5",cursor:"pointer"},onClick:()=>{setCustomerPhoneNumber(j.id),setCustomerNameInput(j.name||""),Q(!1),setTimeout(()=>l(),100)},children:[j.name||"N/A"," - ",j.id]})},j.id))}),e.jsx("button",{style:{marginTop:16,background:"#eee",padding:8,borderRadius:6,border:"none",width:"100%",cursor:"pointer"},onClick:()=>Q(!1),children:"Cancel"})]})}),U&&y&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>R(!1),children:e.jsxs("div",{style:{backgroundColor:"#ffffff",padding:"20px",borderRadius:"8px",boxShadow:"0 4px 10px rgba(0,0,0,0.1)",textAlign:"center",color:"#333333"},onClick:j=>j.stopPropagation(),children:[e.jsx("h4",{style:{marginBottom:"15px",fontSize:"1.2rem",color:"#333333"},children:"Scan to Punch Your Card"}),e.jsx(ke,{value:y,size:200}),e.jsx("p",{style:{fontSize:"1rem",marginTop:"15px",color:"#555555"},children:"Your loyalty punch will be added automatically."}),e.jsx("button",{onClick:()=>R(!1),style:{marginTop:"20px",backgroundColor:"#007bff",color:"#ffffff",padding:"10px 15px",borderRadius:"5px",border:"none",cursor:"pointer"},children:"Close"})]})})]}):e.jsxs("div",{style:{flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem 0.75rem",boxSizing:"border-box"},children:[e.jsxs("div",{style:{maxWidth:"24rem",width:"100%",backgroundColor:"#FFFFFF",border:"1px solid #D1D1D6",borderRadius:"1rem",padding:"1.5rem",display:"flex",flexDirection:"column",gap:"1rem",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.03)"},children:[e.jsx("h2",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#1C1C1E"},children:"Admin Access"}),e.jsx("input",{type:"password",value:h,onChange:p,placeholder:"Enter PIN",style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",backgroundColor:"#FFFFFF",color:"#1C1C1E",border:"1px solid #D1D1D6","::placeholder":{color:"#8E8E93"},boxSizing:"border-box"}}),e.jsx("button",{onClick:b,style:{width:"100%",backgroundColor:"#E5E5EA",color:"#1C1C1E",fontWeight:"600",paddingBlock:"0.75rem",borderRadius:"0.5rem",border:"none",boxSizing:"border-box"},children:"Unlock"})]}),w.text&&e.jsx("div",{style:{position:"fixed",bottom:"1.5rem",left:"50%",transform:"translateX(-50%)",padding:"0.75rem 1.25rem",borderRadius:"0.5rem",backgroundColor:w.type==="error"?"#FFEBEB":w.type==="success"?"#E6F7E9":"#E0F2FE",color:w.type==="error"?"#BF2C2C":w.type==="success"?"#1D7A2E":"#0C5A8A",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:1e3,fontSize:"0.875rem",border:"1px solid ",borderColor:w.type==="error"?"#FAD1D1":w.type==="success"?"#C6E6CC":"#B8DFF8"},children:w.text})]})};function We(){const[C,h]=t.useState(0),p=10,[b,a]=t.useState(!1),[u,d]=t.useState(""),[c,E]=t.useState(""),[l,x]=t.useState(""),[r,f]=t.useState(null),[T,z]=t.useState(!1),[$,m]=t.useState(!1),[I,O]=t.useState(!1),[B,w]=t.useState(!1),[U,y]=t.useState({text:"",type:""}),[R,V]=t.useState(""),[X,Q]=t.useState(!1),[Y,K]=t.useState([]),[v,q]=t.useState(!1),[j,se]=t.useState([]),[ie,ae]=t.useState([]),i=t.useRef(null);t.useEffect(()=>{r?(h(r.punches),z(r.punches>=p),!l&&r.name&&x(r.name)):(h(0),z(!1))},[r,p,l]),t.useEffect(()=>()=>{i.current&&i.current()},[]),t.useEffect(()=>{(async()=>{const n=M(ee(W,"customers")),g=await oe(n),F=[];g.forEach(S=>{F.push({id:S.id,...S.data()})}),se(F)})()},[]),t.useEffect(()=>{const o=M(ee(W,"customers")),n=te(o,g=>{ae(g.docs.map(F=>({id:F.id,...F.data()})))});return()=>n()},[]);const s=(o,n="info")=>{y({text:o,type:n}),setTimeout(()=>{y({text:"",type:""})},2500)},le=()=>{if(!r||!r.id){s("Please load a customer first.","error");return}if(r.punches>=p){s("Reward is already available. Cannot add more punches.","error");return}const o=`PUNCH_TOKEN_${r.id}_${Date.now()}_${Math.random().toString(36).substring(2,10)}`;let n;window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?(n=`${window.location.origin+"/loyalty/"}claim?token=${o}`,console.log("Generated local preview QR URL:",n)):(n=`https://ufoger-usa.github.io/loyalty_app/claim?token=${o}`,console.log("Generated production QR URL:",n)),V(n),Q(!0),s("QR code for customer to scan and get a punch is ready.","info")},de=async()=>{if(!b){s("Please unlock admin access.","error");return}if(!r){s("Please load a customer first.","error");return}if(r.punches>=p){s("Reward is available! Please redeem before adding more punches.","error");return}O(!0),y({text:"",type:""});const o=r.punches<p?r.punches+1:r.punches,n=r.name||l.trim();try{const g=H(W,"customers",r.id);await N(g,{punches:o,name:n,updatedAt:k()},{merge:!0}),s(`Punch added for ${n||r.id}!`,"success")}catch(g){console.error("Error saving punch to Firestore:",g),s("Error saving punch. Please try again.","error")}finally{O(!1)}},ce=async()=>{if(!b){s("Please unlock admin access.","error");return}if(!r||r.punches<p){s("Customer is not eligible for a reward yet or no customer loaded.","error");return}w(!0),y({text:"",type:""});const o=r.name||"Customer",n=r.totalRedemptions||0;try{const g=H(W,"customers",r.id);await N(g,{punches:0,lastRewardRedeemedAt:k(),totalRedemptions:n+1,updatedAt:k()},{merge:!0}),s(`Reward redeemed for ${o}! Punches reset.`,"success")}catch(g){console.error("Error redeeming reward in Firestore:",g),s("Error redeeming reward. Please try again.","error")}finally{w(!1)}},ue=t.useCallback(o=>{d(o.target.value)},[]),me=()=>{u===Ne?(a(!0),d(""),y({text:"",type:""})):(s("Incorrect PIN","error"),d(""))},pe=()=>{a(!1),y({text:"",type:""}),f(null),E(""),x(""),i.current&&(i.current(),i.current=null)},fe=t.useCallback(o=>{E(o.target.value)},[]),he=t.useCallback(o=>{x(o.target.value)},[]),xe=t.useCallback(async()=>{const o=c.trim(),n=l.trim();if(!o){s("Please enter a customer phone number.","error");return}if(/^\d{4}$/.test(o)){m(!0),y({text:"",type:""});const S=M(ee(W,"customers")),A=await oe(S),P=[];if(A.forEach(L=>{L.id.slice(-4)===o&&P.push({id:L.id,...L.data()})}),m(!1),P.length===0){s("No customers found with those last 4 digits.","error");return}else if(P.length===1){E(P[0].id),x(P[0].name||""),i.current&&(i.current(),i.current=null),m(!0),y({text:"",type:""});const L=P[0].id,G=H(W,"customers",L);try{i.current=te(G,async _=>{if(m(!1),_.exists()){const D=_.data(),be={id:_.id,punches:D.punches||0,name:D.name||"",lastRewardRedeemedAt:D.lastRewardRedeemedAt,createdAt:D.createdAt,updatedAt:D.updatedAt,totalRedemptions:D.totalRedemptions||0};f(be),n&&n!==D.name?(await N(G,{name:n,updatedAt:k()},{merge:!0}),s("Customer name updated.","success")):!D.name&&n?(await N(G,{name:n,updatedAt:k()},{merge:!0}),s("Customer name added.","success")):s(`Customer ${D.name||L} loaded.`,"info")}else{const D={id:L,punches:0,name:n,createdAt:k(),updatedAt:k(),lastRewardRedeemedAt:null,totalRedemptions:0};await N(G,D),s(`New customer ${n||L} created.`,"success")}},_=>{console.error("Error in Firestore listener:",_),s("Error listening to customer data. Try reloading.","error"),m(!1),i.current&&(i.current(),i.current=null)})}catch(_){console.error("Error loading or creating customer data:",_),s("Error accessing customer data. Please try again.","error"),m(!1),i.current&&(i.current(),i.current=null)}return}else{K(P),q(!0);return}}i.current&&(i.current(),i.current=null),m(!0),y({text:"",type:""});const g=o,F=H(W,"customers",g);try{i.current=te(F,async S=>{if(m(!1),S.exists()){const A=S.data(),P={id:S.id,punches:A.punches||0,name:A.name||"",lastRewardRedeemedAt:A.lastRewardRedeemedAt,createdAt:A.createdAt,updatedAt:A.updatedAt,totalRedemptions:A.totalRedemptions||0};f(P),n&&n!==A.name?(await N(F,{name:n,updatedAt:k()},{merge:!0}),s("Customer name updated.","success")):!A.name&&n?(await N(F,{name:n,updatedAt:k()},{merge:!0}),s("Customer name added.","success")):s(`Customer ${A.name||g} loaded.`,"info")}else{const A={id:g,punches:0,name:n,createdAt:k(),updatedAt:k(),lastRewardRedeemedAt:null,totalRedemptions:0};await N(F,A),s(`New customer ${n||g} created.`,"success")}},S=>{console.error("Error in Firestore listener:",S),s("Error listening to customer data. Try reloading.","error"),m(!1),i.current&&(i.current(),i.current=null)})}catch(S){console.error("Error loading or creating customer data:",S),s("Error accessing customer data. Please try again.","error"),m(!1),i.current&&(i.current(),i.current=null)}},[c,l,i]),ge=o=>{E(o.id),x(o.name||""),f({id:o.id,punches:o.punches||0,name:o.name||"",lastRewardRedeemedAt:o.lastRewardRedeemedAt,createdAt:o.createdAt,updatedAt:o.updatedAt,totalRedemptions:o.totalRedemptions||0})},J=Ce();return e.jsxs(e.Fragment,{children:[J.pathname==="/"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",minHeight:"100vh",backgroundColor:"#FFFFFF",color:"#1C1C1E",fontFamily:"sans-serif",boxSizing:"border-box"},children:[e.jsxs("div",{style:{textAlign:"center",padding:"1rem 0.75rem",flexShrink:0},children:[e.jsx("h2",{style:{fontSize:"0.75rem",letterSpacing:"0.1em",color:"#3C3C3E",textTransform:"uppercase",fontWeight:"600",marginBottom:"0.25rem"},children:"UFOGER Loyalty System"}),e.jsx("h1",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#1C1C1E"},children:"Admin Panel"})]}),e.jsx("main",{style:{width:"100%",boxSizing:"border-box",flexGrow:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{textAlign:"center",fontSize:"1.25rem",paddingTop:"2rem"},children:"Loading page..."}),children:e.jsx(Ee,{children:e.jsx(we,{path:"/",element:e.jsx(_e,{isAdminUnlocked:b,pinInput:u,handlePinInputChange:ue,handlePinSubmit:me,handleLockAdmin:pe,customerPhoneNumber:c,handlePhoneNumberChange:fe,customerNameInput:l,handleCustomerNameChange:he,loadCustomerData:xe,isLoadingCustomer:$,activeCustomerData:r,currentPunches:C,totalPunches:p,isRewardAvailable:T,addPunch:de,isSavingPunch:I,handleGeneratePunchQrCode:le,redeemReward:ce,isRedeemingReward:B,feedbackMessage:U,isPunchQrModalOpen:X,actionableQrUrl:R,setIsPunchQrModalOpen:Q,matchingCustomers:Y,showMatchModal:v,setShowMatchModal:q,customers:ie,onSelectCustomerByLast4:ge})})})})})]}),J.pathname==="/claim"&&e.jsx("div",{style:{minHeight:"100vh",backgroundColor:"#fff"},children:e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{textAlign:"center",fontSize:"1.25rem",paddingTop:"2rem"},children:"Loading page..."}),children:e.jsx(Ie,{})})}),J.pathname==="/customer"&&e.jsx("div",{style:{minHeight:"100vh",backgroundColor:"#fff"},children:e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{textAlign:"center",fontSize:"1.25rem",paddingTop:"2rem"},children:"Loading page..."}),children:e.jsx(Le,{})})})]})}je.createRoot(document.getElementById("root")).render(e.jsx(t.StrictMode,{children:e.jsx(Re,{children:e.jsx(We,{})})}));export{De as P,W as d};
