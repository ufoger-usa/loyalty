import{b as c,j as t}from"./vendor-ZLzkZQbJ.js";import{q as w,e as A,c as k,o as L,d as D,f as N}from"./vendor_firebase-Ck53W5MB.js";import{d as y}from"./index-BPBmPqb1.js";import"./vendor_react-dom-B1D0ftzI.js";const $=()=>{const[f,S]=c.useState([]),[u,C]=c.useState(""),[j,x]=c.useState(!0),[p,v]=c.useState(null),[o,g]=c.useState({key:"totalRedemptions",direction:"desc"});c.useEffect(()=>{x(!0);const e=w(k(y,"customers"),A("createdAt","desc")),s=L(e,r=>{const n=[];r.forEach(i=>{n.push({id:i.id,...i.data()})}),S(n),x(!1)},r=>{console.error("Error fetching customer records: ",r),v("Failed to load customer records."),x(!1)});return()=>s()},[]);const R=async(e,s)=>{const r=s||e;if(window.confirm(`Are you sure you want to delete customer ${r}? This action cannot be undone.`))try{const n=D(y,"customers",e);await N(n),alert(`Customer ${r} deleted successfully.`)}catch(n){console.error("Error deleting customer: ",n),alert(`Failed to delete customer ${r}. Error: ${n.message}`)}},h=c.useMemo(()=>{let e=[...f];if(u){const s=u.trim();/^\d{4}$/.test(s)?e=e.filter(r=>r.id&&r.id.slice(-4)===s):e=e.filter(r=>r.id.toLowerCase().includes(s.toLowerCase())||r.name&&r.name.toLowerCase().includes(s.toLowerCase()))}return o.key&&e.sort((s,r)=>{const n=(m,l)=>m?l==="createdAt"||l==="lastRedeemedAt"?m[l]?m[l].seconds:null:l==="name"?m[l]||"":m[l]:null,i=n(s,o.key),d=n(r,o.key);let a=0;return i==null?a=d==null?0:1:d==null?a=-1:typeof i=="string"&&typeof d=="string"?a=i.toLowerCase().localeCompare(d.toLowerCase()):typeof i=="number"&&typeof d=="number"?a=i-d:a=String(i).localeCompare(String(d)),o.direction==="asc"?a:-a}),e},[f,u,o]),b=e=>e?new Date(e.seconds*1e3).toLocaleDateString():"N/A";return t.jsxs("div",{style:{backgroundColor:"white",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06)",borderRadius:"0.5rem",padding:"1.5rem",border:"1px solid #e5e7eb",display:"flex",flexDirection:"column",height:"100%",minHeight:"0",boxSizing:"border-box"},children:[t.jsx("h2",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#1f2937",marginBottom:"1rem",flexShrink:0},children:"Customer Records"}),t.jsx("input",{type:"text",placeholder:"Search by Phone, Name, or Last 4 digits...",style:{width:"100%",padding:"0.5rem",marginBottom:"1rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",flexShrink:0,boxSizing:"border-box"},value:u,onChange:e=>C(e.target.value)}),t.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem",alignItems:"center",flexShrink:0},children:[t.jsxs("select",{value:o.key,onChange:e=>g({...o,key:e.target.value}),style:{padding:"0.5rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",backgroundColor:"white",fontSize:"0.875rem"},children:[t.jsx("option",{value:"createdAt",children:"Created Date"}),t.jsx("option",{value:"name",children:"Name"}),t.jsx("option",{value:"punches",children:"Punches"}),t.jsx("option",{value:"lastRedeemedAt",children:"Last Redeemed"}),t.jsx("option",{value:"totalRedemptions",children:"Total Redemptions"})]}),t.jsxs("button",{onClick:()=>g({...o,direction:o.direction==="asc"?"desc":"asc"}),style:{padding:"0.375rem 0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",transition:"background-color 0.2s",fontSize:"0.875rem"},children:["Sort ",o.direction==="asc"?"Ascending":"Descending"]})]}),j?t.jsx("div",{style:{textAlign:"center",padding:"1rem",flexShrink:0},children:"Loading customer records..."}):p?t.jsx("div",{style:{textAlign:"center",padding:"1rem",color:"#ef4444",flexShrink:0},children:p}):h.length===0?t.jsx("p",{style:{color:"#6b7280",flexShrink:0},children:"No customers found."}):t.jsx("ul",{style:{listStyle:"none",margin:0,paddingLeft:0,flexGrow:1,overflowY:"auto",minHeight:"0",maxHeight:"400px",paddingBottom:"0.5rem",boxSizing:"border-box"},children:h.map(e=>t.jsxs("li",{style:{padding:"0.75rem",backgroundColor:"#f9fafb",borderRadius:"0.375rem",border:"1px solid #e5e7eb",marginBottom:"0.75rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[t.jsxs("div",{children:[" ",t.jsxs("div",{className:"font-medium text-gray-700",children:[e.name||"N/A"," - ",t.jsx("span",{className:"text-sm text-sky-600",children:e.id})]}),t.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Punches: ",e.punches||0," / ",e.totalPunches||10]}),t.jsxs("div",{className:"text-sm text-gray-600",children:["Total Redemptions: ",e.totalRedemptions||0]}),t.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Created: ",b(e.createdAt)]}),e.lastRedeemedAt&&t.jsxs("div",{className:"text-xs text-gray-400",children:["Last Redeemed: ",b(e.lastRedeemedAt)]})]}),t.jsx("button",{onClick:()=>R(e.id,e.name),style:{backgroundColor:"#fee2e2",color:"#b91c1c",padding:"0.25rem 0.5rem",borderRadius:"0.25rem",border:"1px solid #fecaca",fontSize:"0.75rem",cursor:"pointer",alignSelf:"flex-start"},children:"Delete Customer"})]},e.id))})]})};export{$ as default};
