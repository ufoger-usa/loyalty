const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ClaimPunchPage-2Dox5-wg.js","assets/vendor-BOSIRU9y.js","assets/vendor_firebase-CiCfdIqM.js","assets/vendor_react-dom-hwKM03QV.js","assets/CustomerRecords-flPjyVa0.js","assets/CustomerPage-BHnFE4YD.js"])))=>i.map(i=>d[i]);
import{j as e,Q as re,b as t,R as te,c as oe,H as ne}from"./vendor-BOSIRU9y.js";import{c as se}from"./vendor_react-dom-hwKM03QV.js";import{i as ie,g as le,d as O,o as ae,s as I,a as D}from"./vendor_firebase-CiCfdIqM.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))p(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const n of l.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&p(n)}).observe(document,{childList:!0,subtree:!0});function a(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function p(o){if(o.ep)return;o.ep=!0;const l=a(o);fetch(o.href,l)}})();const de="modulepreload",ce=function(b){return"/loyalty_app/"+b},$={},Q=function(u,a,p){let o=Promise.resolve();if(a&&a.length>0){let n=function(i){return Promise.all(i.map(x=>Promise.resolve(x).then(r=>({status:"fulfilled",value:r}),r=>({status:"rejected",reason:r}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),C=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));o=n(a.map(i=>{if(i=ce(i),i in $)return;$[i]=!0;const x=i.endsWith(".css"),r=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${r}`))return;const f=document.createElement("link");if(f.rel=x?"stylesheet":de,x||(f.as="script"),f.crossOrigin="",f.href=i,C&&f.setAttribute("nonce",C),document.head.appendChild(f),x)return new Promise((v,S)=>{f.addEventListener("load",v),f.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${i}`)))})}))}function l(n){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=n,window.dispatchEvent(s),!s.defaultPrevented)throw n}return o.then(n=>{for(const s of n||[])s.status==="rejected"&&l(s.reason);return u().catch(l)})};function ue({totalPunches:b=10,currentPunches:u=0}){const a=[];for(let p=0;p<b;p++)a.push(e.jsx("div",{style:{width:"1rem",height:"1rem",borderRadius:"50%",backgroundColor:p<u?"#32D74B":"#E5E5EA"}},p));return e.jsx("div",{style:{display:"flex",justifyContent:"center",gap:"0.375rem"},children:a})}function G({value:b,size:u=128}){return e.jsx("div",{className:"qr-code-container",style:{textAlign:"center"},children:e.jsx("div",{className:"qr-code-actual",style:{marginTop:"10px",marginBottom:"10px"},children:b?e.jsx(re,{value:b,size:u,bgColor:"#ffffff",fgColor:"#000000",level:"L"}):e.jsx("p",{children:"No QR code data available."})})})}const me={apiKey:"AIzaSyB3a-4cuYh3BgstXQPI4XCiTjmuyOtzsSM",authDomain:"ufoger-loyalty.firebaseapp.com",projectId:"ufoger-loyalty",storageBucket:"ufoger-loyalty.firebasestorage.app",messagingSenderId:"474748620137",appId:"1:474748620137:web:3340ce8e46c2406e2341f8"},pe=ie(me),U=le(pe),fe=t.lazy(()=>Q(()=>import("./ClaimPunchPage-2Dox5-wg.js"),__vite__mapDeps([0,1,2,3]))),he=t.lazy(()=>Q(()=>import("./CustomerRecords-flPjyVa0.js"),__vite__mapDeps([4,1,2,3]))),xe=t.lazy(()=>Q(()=>import("./CustomerPage-BHnFE4YD.js"),__vite__mapDeps([5,1,2,3]))),ge="1234",be=({handleLockAdmin:b,customerPhoneNumber:u,handlePhoneNumberChange:a,customerNameInput:p,handleCustomerNameChange:o,loadCustomerData:l,isLoadingCustomer:n,activeCustomerData:s,currentPunches:C,totalPunches:i,isRewardAvailable:x,addPunch:r,isSavingPunch:f,handleGeneratePunchQrCode:v,redeemReward:S,isRedeemingReward:P,feedbackMessage:g})=>{const k=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?window.location.origin+"/loyalty_app/customer":"https://ufoger-usa.github.io/loyalty_app/customer";return e.jsxs("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:"1.25rem",boxSizing:"border-box",overflowY:"auto",padding:"0.1rem"},children:[e.jsxs("div",{style:{backgroundColor:"#FFFFFF",border:"1px solid #D1D1D6",borderRadius:"1rem",padding:"1.5rem",display:"flex",flexDirection:"column",gap:"1rem",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.03)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h2",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#1C1C1E"},children:"Admin Controls"}),e.jsx("button",{onClick:b,style:{backgroundColor:"#D1D1D6",color:"#1C1C1E",padding:"0.375rem 0.75rem",borderRadius:"0.375rem",fontSize:"0.75rem",border:"none"},children:"Lock"})]}),e.jsx("input",{type:"tel",value:u,onChange:a,placeholder:"Customer Phone (ID)",disabled:n,style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",backgroundColor:"#FFFFFF",color:"#1C1C1E",border:"1px solid #D1D1D6","::placeholder":{color:"#8E8E93"},boxSizing:"border-box"}}),e.jsx("input",{type:"text",value:p,onChange:o,placeholder:"Customer Name",disabled:n,style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",backgroundColor:"#FFFFFF",color:"#1C1C1E",border:"1px solid #D1D1D6","::placeholder":{color:"#8E8E93"},boxSizing:"border-box"}}),e.jsx("button",{onClick:l,disabled:n||!u.trim(),style:{width:"100%",backgroundColor:"#E5E5EA",color:"#1C1C1E",fontWeight:"600",paddingBlock:"0.75rem",borderRadius:"0.5rem",border:"none",boxSizing:"border-box"},children:n?"Loading...":"Load/Create"})]}),e.jsxs("div",{style:{backgroundColor:"#FFFFFF",border:"1px solid #D1D1D6",borderRadius:"1rem",padding:"1.5rem",marginBottom:"1rem",display:"flex",flexDirection:"column",alignItems:"center",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.03)"},children:[e.jsx("h4",{style:{margin:0,marginBottom:8,fontSize:"1rem",color:"#1C1C1E"},children:"Customer Self-Service QR"}),e.jsx(G,{value:k,size:140}),e.jsx("div",{style:{fontSize:12,color:"#888",marginTop:8,wordBreak:"break-all",textAlign:"center"},children:k}),e.jsx("div",{style:{fontSize:13,color:"#007bff",marginTop:8,textAlign:"center"},children:"Let customers scan this QR code to access the public punch/sign page."})]}),s&&e.jsxs("div",{style:{backgroundColor:"#FFFFFF",border:"1px solid #D1D1D6",borderRadius:"1rem",padding:"1.5rem",display:"flex",flexDirection:"column",gap:"1rem",textAlign:"center",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.03)"},children:[e.jsxs("h3",{style:{color:"#1C1C1E",fontWeight:"bold",fontSize:"1.125rem"},children:[s.name||"N/A",e.jsxs("span",{style:{fontSize:"0.875rem",color:"#3C3C3E"},children:[" (",s.id,")"]})]}),e.jsx(ue,{currentPunches:C,totalPunches:i,isRewardAvailable:x}),e.jsxs("p",{style:{fontSize:"0.875rem",color:"#3C3C3E"},children:[C," / ",i]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[e.jsx("button",{onClick:r,disabled:f||C>=i||n,style:{backgroundColor:"#E5E5EA",color:"#1C1C1E",fontWeight:"600",paddingBlock:"0.75rem",borderRadius:"0.5rem",border:"none"},children:f?"...":"Add Punch"}),e.jsx("button",{onClick:v,disabled:!s||C>=i||n,style:{backgroundColor:"#E5E5EA",color:"#1C1C1E",fontWeight:"600",paddingBlock:"0.75rem",borderRadius:"0.5rem",border:"none"},children:"Generate Punch QR"}),e.jsx("button",{onClick:S,disabled:P||!x||n,style:{backgroundColor:"#E5E5EA",color:"#1C1C1E",fontWeight:"600",paddingBlock:"0.75rem",borderRadius:"0.5rem",border:"none"},children:P?"...":"Redeem"})]})]}),g.text&&e.jsx("div",{style:{position:"fixed",bottom:"1.5rem",left:"50%",transform:"translateX(-50%)",padding:"0.75rem 1.25rem",borderRadius:"0.5rem",backgroundColor:g.type==="error"?"#FFEBEB":g.type==="success"?"#E6F7E9":"#E0F2FE",color:g.type==="error"?"#BF2C2C":g.type==="success"?"#1D7A2E":"#0C5A8A",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:1e3,fontSize:"0.875rem",border:"1px solid ",borderColor:g.type==="error"?"#FAD1D1":g.type==="success"?"#C6E6CC":"#B8DFF8"},children:g.text})]})},ye=({isAdminUnlocked:b,pinInput:u,handlePinInputChange:a,handlePinSubmit:p,handleLockAdmin:o,customerPhoneNumber:l,handlePhoneNumberChange:n,customerNameInput:s,handleCustomerNameChange:C,loadCustomerData:i,isLoadingCustomer:x,activeCustomerData:r,currentPunches:f,totalPunches:v,isRewardAvailable:S,addPunch:P,isSavingPunch:g,handleGeneratePunchQrCode:k,redeemReward:_,isRedeemingReward:L,feedbackMessage:E,isPunchQrModalOpen:T,actionableQrUrl:F,setIsPunchQrModalOpen:B})=>{const[w,N]=t.useState(window.innerWidth<768);return t.useEffect(()=>{const R=()=>{N(window.innerWidth<768)};return window.addEventListener("resize",R),()=>window.removeEventListener("resize",R)},[]),b?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:w?"column":"row",gap:"1.5rem",width:"100%",maxWidth:w?"100%":"72rem",margin:"0 auto",boxSizing:"border-box",flexGrow:1,padding:"0 0.75rem 1rem 0.75rem",overflowY:w?"auto":"hidden",overflowX:"hidden"},children:[e.jsx("div",{style:{flex:w?"1 1 auto":"1 1 0%",width:w?"100%":"auto",minWidth:w?"unset":"18rem",display:"flex",flexDirection:"column",marginBottom:w?"1.5rem":"0"},children:e.jsx(be,{handleLockAdmin:o,customerPhoneNumber:l,handlePhoneNumberChange:n,customerNameInput:s,handleCustomerNameChange:C,loadCustomerData:i,isLoadingCustomer:x,activeCustomerData:r,currentPunches:f,totalPunches:v,isRewardAvailable:S,addPunch:P,isSavingPunch:g,handleGeneratePunchQrCode:k,redeemReward:_,isRedeemingReward:L,feedbackMessage:E})}),e.jsx("div",{style:{flex:w?"1 1 auto":"2 1 0%",width:w?"100%":"auto",minWidth:w?"unset":"24rem",display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{textAlign:"center",fontSize:"1.1rem",paddingTop:"2rem"},children:"Loading records..."}),children:e.jsx(he,{})})})]}),T&&F&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>B(!1),children:e.jsxs("div",{style:{backgroundColor:"#ffffff",padding:"20px",borderRadius:"8px",boxShadow:"0 4px 10px rgba(0,0,0,0.1)",textAlign:"center",color:"#333333"},onClick:R=>R.stopPropagation(),children:[e.jsx("h4",{style:{marginBottom:"15px",fontSize:"1.2rem",color:"#333333"},children:"Scan to Punch Your Card"}),e.jsx(G,{value:F,size:200}),e.jsx("p",{style:{fontSize:"1rem",marginTop:"15px",color:"#555555"},children:"Your loyalty punch will be added automatically."}),e.jsx("button",{onClick:()=>B(!1),style:{marginTop:"20px",backgroundColor:"#007bff",color:"#ffffff",padding:"10px 15px",borderRadius:"5px",border:"none",cursor:"pointer"},children:"Close"})]})})]}):e.jsxs("div",{style:{flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem 0.75rem",boxSizing:"border-box"},children:[e.jsxs("div",{style:{maxWidth:"24rem",width:"100%",backgroundColor:"#FFFFFF",border:"1px solid #D1D1D6",borderRadius:"1rem",padding:"1.5rem",display:"flex",flexDirection:"column",gap:"1rem",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.03)"},children:[e.jsx("h2",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#1C1C1E"},children:"Admin Access"}),e.jsx("input",{type:"password",value:u,onChange:a,placeholder:"Enter PIN",style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",backgroundColor:"#FFFFFF",color:"#1C1C1E",border:"1px solid #D1D1D6","::placeholder":{color:"#8E8E93"},boxSizing:"border-box"}}),e.jsx("button",{onClick:p,style:{width:"100%",backgroundColor:"#E5E5EA",color:"#1C1C1E",fontWeight:"600",paddingBlock:"0.75rem",borderRadius:"0.5rem",border:"none",boxSizing:"border-box"},children:"Unlock"})]}),E.text&&e.jsx("div",{style:{position:"fixed",bottom:"1.5rem",left:"50%",transform:"translateX(-50%)",padding:"0.75rem 1.25rem",borderRadius:"0.5rem",backgroundColor:E.type==="error"?"#FFEBEB":E.type==="success"?"#E6F7E9":"#E0F2FE",color:E.type==="error"?"#BF2C2C":E.type==="success"?"#1D7A2E":"#0C5A8A",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:1e3,fontSize:"0.875rem",border:"1px solid ",borderColor:E.type==="error"?"#FAD1D1":E.type==="success"?"#C6E6CC":"#B8DFF8"},children:E.text})]})};function Ce(){const[b,u]=t.useState(0),a=10,[p,o]=t.useState(!1),[l,n]=t.useState(""),[s,C]=t.useState(""),[i,x]=t.useState(""),[r,f]=t.useState(null),[v,S]=t.useState(!1),[P,g]=t.useState(!1),[k,_]=t.useState(!1),[L,E]=t.useState(!1),[T,F]=t.useState({text:"",type:""}),[B,w]=t.useState(""),[N,R]=t.useState(!1),h=t.useRef(null);t.useEffect(()=>{r?(u(r.punches),S(r.punches>=a),!i&&r.name&&x(r.name)):(u(0),S(!1))},[r,a,i]),t.useEffect(()=>()=>{h.current&&h.current()},[]);const d=(m,c="info")=>{F({text:m,type:c}),setTimeout(()=>{F({text:"",type:""})},2500)},q=()=>{if(!r||!r.id){d("Please load a customer first.","error");return}if(r.punches>=a){d("Reward is already available. Cannot add more punches.","error");return}const m=`PUNCH_TOKEN_${r.id}_${Date.now()}_${Math.random().toString(36).substring(2,10)}`;let c;window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?(c=`${window.location.origin+"/loyalty_app/"}claim?token=${m}`,console.log("Generated local preview QR URL:",c)):(c=`https://ufoger-usa.github.io/loyalty_app/claim?token=${m}`,console.log("Generated production QR URL:",c)),w(c),R(!0),d("QR code for customer to scan and get a punch is ready.","info")},H=async()=>{if(!p){d("Please unlock admin access.","error");return}if(!r){d("Please load a customer first.","error");return}if(r.punches>=a){d("Reward is available! Please redeem before adding more punches.","error");return}_(!0),F({text:"",type:""});const m=r.punches<a?r.punches+1:r.punches,c=r.name||i.trim();try{const y=O(U,"customers",r.id);await I(y,{punches:m,name:c,updatedAt:D()},{merge:!0}),d(`Punch added for ${c||r.id}!`,"success")}catch(y){console.error("Error saving punch to Firestore:",y),d("Error saving punch. Please try again.","error")}finally{_(!1)}},V=async()=>{if(!p){d("Please unlock admin access.","error");return}if(!r||r.punches<a){d("Customer is not eligible for a reward yet or no customer loaded.","error");return}E(!0),F({text:"",type:""});const m=r.name||"Customer",c=r.totalRedemptions||0;try{const y=O(U,"customers",r.id);await I(y,{punches:0,lastRewardRedeemedAt:D(),totalRedemptions:c+1,updatedAt:D()},{merge:!0}),d(`Reward redeemed for ${m}! Punches reset.`,"success")}catch(y){console.error("Error redeeming reward in Firestore:",y),d("Error redeeming reward. Please try again.","error")}finally{E(!1)}},X=t.useCallback(m=>{n(m.target.value)},[]),Y=()=>{l===ge?(o(!0),n(""),F({text:"",type:""})):(d("Incorrect PIN","error"),n(""))},K=()=>{o(!1),F({text:"",type:""}),f(null),C(""),x(""),h.current&&(h.current(),h.current=null)},J=t.useCallback(m=>{C(m.target.value)},[]),Z=t.useCallback(m=>{x(m.target.value)},[]),M=t.useCallback(async()=>{const m=s.trim(),c=i.trim();if(!m){d("Please enter a customer phone number.","error");return}h.current&&(h.current(),h.current=null),g(!0),F({text:"",type:""});const y=m,z=O(U,"customers",y);try{h.current=ae(z,async A=>{if(g(!1),A.exists()){const j=A.data(),ee={id:A.id,punches:j.punches||0,name:j.name||"",lastRewardRedeemedAt:j.lastRewardRedeemedAt,createdAt:j.createdAt,updatedAt:j.updatedAt,totalRedemptions:j.totalRedemptions||0};f(ee),c&&c!==j.name?(await I(z,{name:c,updatedAt:D()},{merge:!0}),d("Customer name updated.","success")):!j.name&&c?(await I(z,{name:c,updatedAt:D()},{merge:!0}),d("Customer name added.","success")):d(`Customer ${j.name||y} loaded.`,"info")}else{const j={id:y,punches:0,name:c,createdAt:D(),updatedAt:D(),lastRewardRedeemedAt:null,totalRedemptions:0};await I(z,j),d(`New customer ${c||y} created.`,"success")}},A=>{console.error("Error in Firestore listener:",A),d("Error listening to customer data. Try reloading.","error"),g(!1),h.current&&(h.current(),h.current=null)})}catch(A){console.error("Error loading or creating customer data:",A),d("Error accessing customer data. Please try again.","error"),g(!1),h.current&&(h.current(),h.current=null)}},[s,i,h]),W=window.location.hash.replace(/^#\/?/,"/");return e.jsxs(e.Fragment,{children:[W==="/"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",minHeight:"100vh",backgroundColor:"#FFFFFF",color:"#1C1C1E",fontFamily:"sans-serif",boxSizing:"border-box"},children:[e.jsxs("div",{style:{textAlign:"center",padding:"1rem 0.75rem",flexShrink:0},children:[e.jsx("h2",{style:{fontSize:"0.75rem",letterSpacing:"0.1em",color:"#3C3C3E",textTransform:"uppercase",fontWeight:"600",marginBottom:"0.25rem"},children:"UFOGER Loyalty System"}),e.jsx("h1",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#1C1C1E"},children:"Admin Panel"})]}),e.jsx("main",{style:{width:"100%",boxSizing:"border-box",flexGrow:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{textAlign:"center",fontSize:"1.25rem",paddingTop:"2rem"},children:"Loading page..."}),children:e.jsx(te,{children:e.jsx(oe,{path:"/",element:e.jsx(ye,{isAdminUnlocked:p,pinInput:l,handlePinInputChange:X,handlePinSubmit:Y,handleLockAdmin:K,customerPhoneNumber:s,handlePhoneNumberChange:J,customerNameInput:i,handleCustomerNameChange:Z,loadCustomerData:M,isLoadingCustomer:P,activeCustomerData:r,currentPunches:b,totalPunches:a,isRewardAvailable:v,addPunch:H,isSavingPunch:k,handleGeneratePunchQrCode:q,redeemReward:V,isRedeemingReward:L,feedbackMessage:T,isPunchQrModalOpen:N,actionableQrUrl:B,setIsPunchQrModalOpen:R})})})})})]}),W==="/claim"&&e.jsx("div",{style:{minHeight:"100vh",backgroundColor:"#fff"},children:e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{textAlign:"center",fontSize:"1.25rem",paddingTop:"2rem"},children:"Loading page..."}),children:e.jsx(fe,{})})}),W==="/customer"&&e.jsx("div",{style:{minHeight:"100vh",backgroundColor:"#fff"},children:e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{textAlign:"center",fontSize:"1.25rem",paddingTop:"2rem"},children:"Loading page..."}),children:e.jsx(xe,{})})})]})}se.createRoot(document.getElementById("root")).render(e.jsx(t.StrictMode,{children:e.jsx(ne,{children:e.jsx(Ce,{})})}));export{ue as P,U as d};
